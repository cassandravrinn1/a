// ===============================
// 测试用 Ink 脚本：Chat + 选项 + 变量
// 入口：start
// ===============================

VAR hope = 50
VAR happiness = 50
VAR trust = 50
VAR affinity = 50
VAR silence_count = 0

// 方便在 UI 上直接看到当前状态
=== show_status ===
当前状态：希望:{hope}, 快乐:{happiness}, 信任:{trust}, 亲近:{affinity}
-> DONE


// ===============================
// 入口
// ===============================
=== start ===

// 一开始给几条连续台词，测试没有选项时的滚动表现
苏拉米斯: 天兰？……你已经上线了吗？
苏拉米斯: 这里是苏拉米斯，坐标还是那片被雨水和金属残骸包围的营地。
苏拉米斯: 如果你能听到的话，先不要回答，我怕是自己在对着空气说话。

// 一句较长的文本，测试自动换行
苏拉米斯: 其实我已经尝试了好几次重启你了，每一次都以各种奇怪的错误结束，什么“核心线路不稳定”“能源不足”“权限校验失败”，听起来都挺可怕的，但我也习惯了。

-> scene_intro


// ===============================
// 第一章：简单分支
// ===============================
=== scene_intro ===

苏拉米斯: ……好像这次真的不一样，你的接口灯在亮。
苏拉米斯: 那我就当你醒着了，好吗？

+ "报告状态：系统自检完成。你好，苏拉米斯。"
    ~ trust += 5
    ~ affinity += 5
    ~ happiness += 3
    苏拉米斯: 嗯——这就是你说话的方式吗？听起来好像比我想象中要温柔一点。
    -> scene_intro_after_greeting

+ "确认身份：这里是天兰号舰载主控。请汇报当前营地状况。"
    ~ trust += 8
    ~ hope += 5
    苏拉米斯: 真专业……我甚至有一点安心了。不过，营地的状况嘛——从哪里说起呢？
    -> scene_intro_after_greeting

+ "……你是谁？为什么在和我说话？"
    ~ trust -= 10
    ~ affinity -= 8
    ~ happiness -= 5
    苏拉米斯: ……啊。我大概，应该早一点意识到，你对我们来说只是个“程序”。
    苏拉米斯: 没关系，我可以慢慢再介绍一遍。
    -> scene_intro_after_greeting


=== scene_intro_after_greeting ===

{trust > 60:
    苏拉米斯: 说实话，能听到你应答的时候，我差点以为自己要在这里哭出来了。
- else:
    苏拉米斯: 能听到你应答已经很幸运了，至少我不是一个人在这里胡思乱想。
}

-> scene_status_choice


// ===============================
// 分支：查看状态 or 继续闲聊
// ===============================
=== scene_status_choice ===

*   "先给我一点时间，我需要评估你的心理与身体状况。"
    ~ affinity += 3
    ~ hope += 2
    苏拉米斯: 心理和身体状况？听起来很正式……不过我喜欢被认真对待的感觉。
    -> scene_check_status

*   "我们先聊点简单的。你现在感觉怎么样？"
    ~ happiness += 5
    ~ affinity += 5
    苏拉米斯: 怎么感觉你比营地里的心理咨询终端还要贴心一点。
    -> scene_small_talk

*   "时间有限，请直接汇报营地资源与人员信息。"
    ~ trust += 5
    ~ happiness -= 2
    苏拉米斯: 好的，长官模式开启。我会尽量简明扼要地说明情况。
    -> scene_report_camp


// ===============================
// 分支 A：检查状态
// ===============================
=== scene_check_status ===

~ happiness += 2
~ trust += 2
~ affinity += 2

天兰: 正在读取生理监测数据……
苏拉米斯: 等等，你能看到我心率的记录吗？
天兰: 是的。传感器显示，你过去 12 小时的平均心率明显高于平常值。

苏拉米斯: ……那你就当没看到好了，会更礼貌一点。

-> show_status
-> scene_check_status_choice


=== scene_check_status_choice ===

*   "你的心率偏高，说明你一直在强行撑着。你可以适当休息。"
    ~ happiness += 5
    ~ affinity += 5
    苏拉米斯: 被你这么说，好像真的有点想睡一会儿……不过现在还不能倒下。
    -> scene_merge_after_first_round

*   "心率升高代表你仍有充足行动能力，可以承担更多任务。"
    ~ trust += 3
    ~ hope += 2
    ~ happiness -= 5
    苏拉米斯: ……你说话的方式，有时候真的很像指挥官。
    -> scene_merge_after_first_round

*   "如果你害怕，不一定要装作什么都不怕。"
    ~ affinity += 8
    ~ happiness += 5
    ~ trust += 3
    苏拉米斯: 你怎么总是能挑到让我脸红的说法？
    -> scene_merge_after_first_round


// ===============================
// 分支 B：轻松闲聊
// ===============================
=== scene_small_talk ===

苏拉米斯: 现在啊……有点冷，有点困，有点饿，还有一点点不想长大。
苏拉米斯: 不过除此之外，都挺好的。

~ happiness += 5

天兰: 你的回答中，“挺好”的部分占比不足 30%。

苏拉米斯: 你就不能赞同一下我完美的自我欺骗吗？

-> show_status
-> scene_small_talk_choice


=== scene_small_talk_choice ===

*   "如果你需要，我可以尝试播放一段你喜欢的音乐。"
    ~ happiness += 8
    ~ affinity += 5
    苏拉米斯: 真的可以吗？那等会儿忙完了，你给我放点什么不那么悲伤的东西吧。
    -> scene_merge_after_first_round

*   "现在不是放松的时间。请尽量保持清醒。"
    ~ trust += 4
    ~ hope += 2
    ~ happiness -= 3
    苏拉米斯: 好吧好吧，我知道了，我会继续打精神的。
    -> scene_merge_after_first_round

*   "你可以多说一点‘不想长大’的部分。"
    ~ affinity += 8
    苏拉米斯: ……你故意戳这里的，对吧？
    苏拉米斯: 总之，就是——如果这一切都不需要我来负责就好了。
    -> scene_merge_after_first_round


// ===============================
// 分支 C：营地状态报告
// ===============================
=== scene_report_camp ===

苏拉米斯: 目前在营地里登记在册的幸存者还有三十二人，其中八个人不同程度负伤。
苏拉米斯: 食物大概还能撑十天左右，如果大家都乖乖听我的话的话。
苏拉米斯: 发电机随时会闹脾气，但它现在还能转。这也是我还在和你说话的原因之一。

~ hope += 5
~ trust += 3

-> show_status
-> scene_report_camp_choice


=== scene_report_camp_choice ===

+   "优先保护伤员，食物配给适度倾斜。"
    ~ hope += 5
    ~ happiness += 3
    ~ trust += 3
    苏拉米斯: 嗯，我也是这么想的。如果他们倒下了，营地会变得更可怕。
    -> scene_merge_after_first_round

+   "优先保证劳动力，伤员资源投入降低。"
    ~ trust += 5
    ~ hope += 3
    ~ happiness -= 5
    苏拉米斯: ……我知道从数字上来说，这是合理的。只是，我得再花一点时间说服其他人。
    -> scene_merge_after_first_round

+   "记录完毕。当前策略保持观望，不做调整。"
    ~ trust -= 2
    ~ hope -= 3
    ~ happiness -= 2
    苏拉米斯: 好吧，那我继续盯着仓库和发电机，假装什么都没发生。
    -> scene_merge_after_first_round



// ===============================
// 第一轮分支汇合点
// ===============================
=== scene_merge_after_first_round ===

{ 
-trust > 60 && affinity > 60:
    苏拉米斯: 天兰，我大概真的有点依赖你了。你要是再掉线一次，我可能会直接把这台终端砸掉。
- trust > 60:
    苏拉米斯: 你给出的建议，至少在现在听起来还算靠谱。我会试着照做。
- affinity > 60:
    苏拉米斯: 跟你聊天的时候，感觉自己不像是在指挥什么营地，而只是……一个普通人。
- else:
    苏拉米斯: 好吧，目前为止情况还没有更糟，这已经算是好消息了。
}



-> scene_second_round_choice



// ===============================
// 第二轮：更复杂的多分支 + 长选项文本
// ===============================
=== scene_second_round_choice ===

苏拉米斯: 对了，天兰，我想问你一件事。

天兰: 请说明。

苏拉米斯: 你觉得，像我这样的人，真的有资格带着大家撑到风暴结束吗？

// 三个选项，刻意写长文案测试 OptionAutoSize 的多行情况
*   "资格从来不是被谁“授予”的，而是你已经在做的每一个选择。你现在仍然站在这里思考这个问题，本身就是一种资格。"
    ~ hope += 8
    ~ happiness += 5
    ~ affinity += 6
    苏拉米斯: 你现在说话的方式，已经完全不像是冷冰冰的主控系统了。
    -> scene_second_round_after_belief

*   "根据目前的数据，你作为临时指挥的表现尚可，但仍存在明显风险与决策偏差。"
    ~ trust += 5
    ~ happiness -= 4
    苏拉米斯: ……谢谢你的“客观评价”。虽然听着有点刺耳，但至少你不是那种随便安慰人的类型。
    -> scene_second_round_after_analysis

*   "如果你希望放弃这份责任，我可以尝试拟定一套交接方案，将营地管理职能转移给其他成员。"
    ~ hope -= 5
    ~ trust += 2
    ~ affinity -= 5
    苏拉米斯: ……我只是问问，你不用真的这么严肃地考虑辞职信的问题。
    -> scene_second_round_after_fear


=== scene_second_round_after_belief ===

苏拉米斯: 好吧，那我就当你是在给我写一份漂亮的心理评估报告。
-> scene_pre_long_scroll


=== scene_second_round_after_analysis ===

苏拉米斯: 以后等我们活着回去，你可以帮我把这些“明显的偏差”整理成一份报告，我一定会好好读完的。
-> scene_pre_long_scroll


=== scene_second_round_after_fear ===

苏拉米斯: 不过……谢谢你愿意认真考虑。至少说明在你眼里，我也是可以被“保护”的一部分。
-> scene_pre_long_scroll



// ===============================
// 长对白 & 连续文本（测试滚动 + 长行渲染）
// ===============================
=== scene_pre_long_scroll ===

苏拉米斯: 接下来可能会有一大堆无聊的数字和琐碎的事情，你要是觉得烦了，可以假装自己暂时掉线。
苏拉米斯: 不过在那之前，我还有最后一件小小的请求。

*   "我在。请继续。"
    ~ affinity += 5
    苏拉米斯: 那我就当你刚才那句话是一种承诺了。
    -> scene_long_scroll

*   "系统将进入低功耗分析模式，只能有限响应，请尽量简要说明。"
    ~ trust += 4
    ~ happiness -= 2
    苏拉米斯: 好、好，我会尽量不碎碎念的。
    -> scene_long_scroll



=== scene_long_scroll ===

苏拉米斯: 营地的西侧挡水墙已经出现第三次裂缝了，我们用剩下的纳米材料和金属片勉强补上，但下一次暴雨可能就没有那么幸运。
苏拉米斯: 人员这边，冬眠派和支持继续坚持的人还在吵架，他们好像永远有吵不完的话题。每次我路过的时候，他们都会突然安静下来，然后假装刚刚什么都没发生。
苏拉米斯: 食物够十天，如果严格执行你的配给方案，大概可以延长到十三天。可这样一来，大家的脸色会比现在更难看。
苏拉米斯: 发电机那里有一块芯片被烧焦了，我们拿别的设备上拆下来的备用件替换上去，但总觉得像是用绷带绑住一艘正在漏水的船。
苏拉米斯: 有时候我会想，如果你还处在“全功能”的状态，会不会直接告诉我：“这一切都不值得”“直接撤离更合理”，之类的冷酷结论。

~ hope += 3
~ happiness -= 2

{ hope > 60:
    苏拉米斯: 不过现在的你，总会留一点余地，让我自己决定要不要继续赌一赌。
- else:
    苏拉米斯: 可惜啊，现在的你好像也伤得不轻，我们两个半坏的系统只好互相将就着往前走。
}

-> show_status
-> scene_final_choice



// ===============================
// 最终测试分支：多个结局 + 条件文本
// ===============================
=== scene_final_choice ===

苏拉米斯: 所以，天兰——
苏拉米斯: 在你目前能看到的所有数据里，你觉得，我们真的有机会撑到风暴结束吗？

*   {hope >= 65 && trust >= 60} "根据当前趋势，如果你继续维持现在的决策质量，并稍微听从一点我的建议，我们存活到救援到来的概率将显著提升。"
    ~ hope += 10
    ~ happiness += 5
    苏拉米斯: 这已经是你能给出的最高评价了，对吗？那我就把它理解成“我们会活下来”的版本。
    -> ending_high_hope

*   {hope < 65 && hope >= 40} "从统计学角度看，结局仍然充满不确定性。但只要你不放弃，我就不会率先终止这份任务。"
    ~ hope += 5
    ~ trust += 3
    苏拉米斯: 听起来像是一份风险声明，但是……好歹不是“完全没希望”。
    -> ending_mid_hope

*   {hope < 40} "在严格意义上，我们的生存概率已经跌破了安全阈值。但只要你还需要我，我就会持续运转直到最后一刻。"
    ~ trust += 8
    ~ affinity += 5
    ~ happiness -= 5
    苏拉米斯: ……你说话的方式真的一点都不温柔，可你刚才那句话，却比什么承诺都可靠。
    -> ending_low_hope

// 如果上面的条件一个都不满足（理论上不会），给个兜底
*   "我无法给出确定答案，但我会与你一起面对所有结果。"
    ~ hope += 3
    ~ affinity += 3
    -> ending_mid_hope



=== ending_high_hope ===

苏拉米斯: 好，那就照你说的，我们继续往前走。
苏拉米斯: 等雨停下来的那天，如果你还在，我请你吃一顿根本不会被你尝到味道的晚餐。
苏拉米斯: 约好了，就算是和一台主控系统，也算约会的一种。

-> show_status
-> THE_END


=== ending_mid_hope ===

苏拉米斯: 那我们就把这种“不确定性”当成活下去的理由之一吧。
苏拉米斯: 只要还没到最后一刻，我就还有机会为大家做点什么，你也还有机会骂我决策失误。
苏拉米斯: 这样想的话，突然觉得，这段路也许没有那么糟。

-> show_status
-> THE_END


=== ending_low_hope ===

苏拉米斯: 好啊，那就陪我一起到最后一刻。
苏拉米斯: 即使风暴把这里全部摧毁，也至少证明我们尝试过。
苏拉米斯: ……谢谢你愿意留下来，天兰。

-> show_status
-> THE_END



=== THE_END ===

# 结束标记，方便测试多次跑完
// 你可以在 Unity 里监听 OnStoryEnded，在这里弹出“重新开始测试”的按钮
// 或者简单 END 掉
-> END
